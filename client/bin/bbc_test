#!/usr/bin/env ruby

require 'socket'

require_relative '../lib/bomberboys_client'
include BomberboysClient

def help
  puts 'Choose a action:'
  puts '? to see this menu'
  puts '0 to see context'
  puts '1 to move_me'
  puts '2 to plant_bomb'
  puts '3 to exit'
end

address = ARGV[0] || 'localhost'
port = ARGV[1] || 10011

begin
  socket = TCPSocket.open(address, port)
rescue
  raise "No server listening on #{address}:#{port}"
end

help

print 'login name: '
client.login($stdin.gets.chomp)

client = Client.new(ServerInterface.new(socket))
game = Game.new
client.register(game)

client.connect
client.start

begin
  print "> "
  option = $stdin.gets.chomp

  case option
  when '?'
    help
  when '0'
    puts game.players
    puts game.bombs
  when '1'
    print 'direction (n, s, e, w, ne, nw, se, sw): '
    client.move_me($stdin.gets.chomp.to_sym)
  when '2'
    client.plant_bomb
  end
end while option != '3'

socket.close
